<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Profil</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #007AFF;
            --secondary-color: #34C759;
            --error-color: #FF3B30;
            --text-color: #1C1C1E;
            --light-text: #8E8E93;
            --background: #F2F2F7;
            --card-background: #FFFFFF;
            --border-color: #D1D1D6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }
        
        body {
            background-color: var(--background);
            color: var(--text-color);
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .back-btn {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-size: 20px;
        }
        
        .profile-header {
            text-align: center;
            padding: 20px 0;
        }
        
        .profile-pic {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid white;
            margin-bottom: 10px;
            background-color: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            color: var(--light-text);
            font-size: 40px;
        }
        
        .profile-name {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .profile-email {
            font-size: 16px;
            color: var(--light-text);
            margin-bottom: 15px;
        }
        
        .profile-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: 600;
        }
        
        .stat-label {
            font-size: 14px;
            color: var(--light-text);
        }
        
        .profile-section {
            background-color: var(--card-background);
            margin: 15px;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .edit-btn {
            color: var(--primary-color);
            font-size: 14px;
            background: none;
            border: none;
            cursor: pointer;
        }
        
        .info-item {
            display: flex;
            margin-bottom: 15px;
        }
        
        .info-label {
            width: 120px;
            font-size: 14px;
            color: var(--light-text);
        }
        
        .info-value {
            flex: 1;
            font-size: 16px;
        }
        
        .logout-btn {
            display: block;
            width: calc(100% - 30px);
            margin: 20px 15px;
            padding: 15px;
            background-color: var(--error-color);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            width: 90%;
            max-width: 400px;
            border-radius: 14px;
            overflow: hidden;
            animation: modalOpen 0.3s ease;
        }
        
        @keyframes modalOpen {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .modal-header {
            padding: 16px;
            text-align: center;
            font-weight: 500;
            border-bottom: 1px solid var(--border-color);
        }
        
        .modal-body {
            padding: 16px;
        }
        
        .modal-footer {
            display: flex;
            border-top: 1px solid var(--border-color);
        }
        
        .modal-btn {
            flex: 1;
            padding: 16px;
            text-align: center;
            font-weight: 500;
            cursor: pointer;
        }
        
        .modal-btn.cancel {
            color: var(--error-color);
            border-right: 1px solid var(--border-color);
        }
        
        .modal-btn.save {
            color: var(--primary-color);
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: var(--text-color);
            font-weight: 500;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 16px;
            font-size: 16px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            background-color: var(--background);
        }
        
        @media (max-width: 480px) {
            .profile-pic {
                width: 80px;
                height: 80px;
                font-size: 30px;
            }
            
            .profile-name {
                font-size: 20px;
            }
            
            .profile-email {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <header>
        <a href="home.html" class="back-btn">
            <i class="fas fa-arrow-left"></i>
        </a>
        <h1>Mon Profil</h1>
    </header>
    
    <div class="profile-header">
        <div class="profile-pic" id="profileInitials">
            <!-- Initials will be added by JS -->
        </div>
        <h2 class="profile-name" id="profileName">John Doe</h2>
        <p class="profile-email" id="profileEmail">john@example.com</p>
        
        <div class="profile-stats">
            <div class="stat-item">
                <div class="stat-value" id="accountAge">0</div>
                <div class="stat-label">jours</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">Niger</div>
                <div class="stat-label">Pays</div>
            </div>
        </div>
    </div>
    
    <div class="profile-section">
        <h3 class="section-title">
            Informations personnelles
            <button class="edit-btn" id="editPersonalInfo">
                <i class="fas fa-pencil-alt"></i> Modifier
            </button>
        </h3>
        
        <div class="info-item">
            <div class="info-label">Nom complet</div>
            <div class="info-value" id="infoName">John Doe</div>
        </div>
        
        <div class="info-item">
            <div class="info-label">Email</div>
            <div class="info-value" id="infoEmail">john@example.com</div>
        </div>
        
        <div class="info-item">
            <div class="info-label">Téléphone</div>
            <div class="info-value" id="infoPhone">+227 86 50 86 82</div>
        </div>
        
        <div class="info-item">
            <div class="info-label">Date de naissance</div>
            <div class="info-value" id="infoBirthdate">01/01/1990</div>
        </div>
        
        <div class="info-item">
            <div class="info-label">Région</div>
            <div class="info-value" id="infoRegion">Niamey</div>
        </div>
    </div>
    
    <div class="profile-section">
        <h3 class="section-title">
            Sécurité
            <button class="edit-btn" id="editSecurity">
                <i class="fas fa-pencil-alt"></i> Modifier
            </button>
        </h3>
        
        <div class="info-item">
            <div class="info-label">Mot de passe</div>
            <div class="info-value">••••••••</div>
        </div>
    </div>
    
    <button class="logout-btn" id="logoutBtn">
        <i class="fas fa-sign-out-alt"></i> Déconnexion
    </button>
    
    <!-- Modal pour modifier les informations personnelles -->
    <div class="modal" id="personalInfoModal">
        <div class="modal-content">
            <div class="modal-header">
                Modifier les informations
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="editName">Nom complet</label>
                    <input type="text" id="editName" placeholder="Votre nom complet">
                </div>
                <div class="form-group">
                    <label for="editPhone">Téléphone</label>
                    <input type="tel" id="editPhone" placeholder="Votre numéro de téléphone">
                </div>
                <div class="form-group">
                    <label for="editBirthdate">Date de naissance</label>
                    <input type="date" id="editBirthdate">
                </div>
                <div class="form-group">
                    <label for="editRegion">Région</label>
                    <select id="editRegion">
                        <option value="Tahoua">Tahoua</option>
                        <option value="Zinder">Zinder</option>
                        <option value="Maradi">Maradi</option>
                        <option value="Agadez">Agadez</option>
                        <option value="Dosso">Dosso</option>
                        <option value="Tillabery">Tillabery</option>
                        <option value="Diffa">Diffa</option>
                        <option value="Niamey">Niamey</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <div class="modal-btn cancel" id="cancelPersonalEdit">Annuler</div>
                <div class="modal-btn save" id="savePersonalInfo">Enregistrer</div>
            </div>
        </div>
    </div>
    
    <!-- Modal pour modifier le mot de passe -->
    <div class="modal" id="securityModal">
        <div class="modal-content">
            <div class="modal-header">
                Modifier le mot de passe
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="currentPassword">Mot de passe actuel</label>
                    <input type="password" id="currentPassword" placeholder="Entrez votre mot de passe actuel">
                </div>
                <div class="form-group">
                    <label for="newPassword">Nouveau mot de passe</label>
                    <input type="password" id="newPassword" placeholder="Entrez votre nouveau mot de passe">
                </div>
                <div class="form-group">
                    <label for="confirmNewPassword">Confirmer le nouveau mot de passe</label>
                    <input type="password" id="confirmNewPassword" placeholder="Confirmez votre nouveau mot de passe">
                </div>
            </div>
            <div class="modal-footer">
                <div class="modal-btn cancel" id="cancelSecurityEdit">Annuler</div>
                <div class="modal-btn save" id="saveSecurityChanges">Enregistrer</div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Vérifier si l'utilisateur est connecté
            if (localStorage.getItem('loggedIn') !== 'true') {
                window.location.href = 'login.html';
            }
            
            // Récupérer les informations de l'utilisateur
            const currentUser = JSON.parse(localStorage.getItem('currentUser')) || {};
            const userAccounts = JSON.parse(localStorage.getItem('userAccounts')) || [];
            const dbUsers = JSON.parse(localStorage.getItem('dbUsers')) || [];
            
            // Trouver l'utilisateur dans dbUsers pour plus d'informations
            const dbUser = dbUsers.find(user => user.email === currentUser.email) || {};
            
            // Afficher les informations du profil
            function displayProfileInfo() {
                // Afficher les initiales
                const nameParts = currentUser.name.split(' ');
                const initials = nameParts.map(part => part[0]).join('').toUpperCase();
                document.getElementById('profileInitials').textContent = initials;
                
                // Afficher les informations de base
                document.getElementById('profileName').textContent = currentUser.name;
                document.getElementById('profileEmail').textContent = currentUser.email;
                document.getElementById('infoName').textContent = currentUser.name;
                document.getElementById('infoEmail').textContent = currentUser.email;
                document.getElementById('infoPhone').textContent = dbUser.phone || currentUser.phone || '+227 86 50 86 82';
                document.getElementById('infoBirthdate').textContent = formatDate(currentUser.birthdate);
                document.getElementById('infoRegion').textContent = currentUser.region || dbUser.region || 'Non spécifié';
                
                // Calculer l'âge du compte
                if (dbUser.date) {
                    const accountCreation = new Date(dbUser.date);
                    const today = new Date();
                    const diffTime = Math.abs(today - accountCreation);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    document.getElementById('accountAge').textContent = diffDays;
                }
                
                // Pré-remplir les champs du modal d'édition
                document.getElementById('editName').value = currentUser.name;
                document.getElementById('editPhone').value = dbUser.phone || currentUser.phone || '';
                document.getElementById('editBirthdate').value = currentUser.birthdate || '';
                document.getElementById('editRegion').value = currentUser.region || dbUser.region || 'Niamey';
            }
            
            // Formater la date
            function formatDate(dateString) {
                if (!dateString) return 'Non spécifié';
                const date = new Date(dateString);
                return date.toLocaleDateString('fr-FR');
            }
            
            // Gérer la déconnexion
            document.getElementById('logoutBtn').addEventListener('click', function() {
                localStorage.removeItem('loggedIn');
                localStorage.removeItem('currentUser');
                window.location.href = 'login.html';
            });
            
            // Gérer l'édition des informations personnelles
            document.getElementById('editPersonalInfo').addEventListener('click', function() {
                document.getElementById('personalInfoModal').style.display = 'flex';
            });
            
            document.getElementById('cancelPersonalEdit').addEventListener('click', function() {
                document.getElementById('personalInfoModal').style.display = 'none';
            });
            
            document.getElementById('savePersonalInfo').addEventListener('click', function() {
                // Mettre à jour les informations
                const newName = document.getElementById('editName').value;
                const newPhone = document.getElementById('editPhone').value;
                const newBirthdate = document.getElementById('editBirthdate').value;
                const newRegion = document.getElementById('editRegion').value;
                
                // Mettre à jour currentUser
                currentUser.name = newName;
                currentUser.birthdate = newBirthdate;
                currentUser.region = newRegion;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                // Mettre à jour userAccounts
                const userIndex = userAccounts.findIndex(user => user.email === currentUser.email);
                if (userIndex !== -1) {
                    userAccounts[userIndex].name = newName;
                    localStorage.setItem('userAccounts', JSON.stringify(userAccounts));
                }
                
                // Mettre à jour dbUsers
                const dbUserIndex = dbUsers.findIndex(user => user.email === currentUser.email);
                if (dbUserIndex !== -1) {
                    dbUsers[dbUserIndex].name = newName;
                    dbUsers[dbUserIndex].phone = newPhone;
                    dbUsers[dbUserIndex].info = `Région: ${newRegion}, Date de naissance: ${newBirthdate}`;
                    localStorage.setItem('dbUsers', JSON.stringify(dbUsers));
                }
                
                // Recharger les informations
                displayProfileInfo();
                document.getElementById('personalInfoModal').style.display = 'none';
            });
            
            // Gérer l'édition de la sécurité
            document.getElementById('editSecurity').addEventListener('click', function() {
                document.getElementById('securityModal').style.display = 'flex';
            });
            
            document.getElementById('cancelSecurityEdit').addEventListener('click', function() {
                document.getElementById('securityModal').style.display = 'none';
            });
            
            document.getElementById('saveSecurityChanges').addEventListener('click', function() {
                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmNewPassword = document.getElementById('confirmNewPassword').value;
                
                // Valider les champs
                if (!currentPassword || !newPassword || !confirmNewPassword) {
                    alert('Veuillez remplir tous les champs');
                    return;
                }
                
                if (newPassword !== confirmNewPassword) {
                    alert('Les nouveaux mots de passe ne correspondent pas');
                    return;
                }
                
                if (newPassword.length < 8) {
                    alert('Le mot de passe doit contenir au moins 8 caractères');
                    return;
                }
                
                // Vérifier le mot de passe actuel
                const userIndex = userAccounts.findIndex(user => 
                    user.email === currentUser.email && user.password === currentPassword
                );
                
                if (userIndex === -1) {
                    alert('Mot de passe actuel incorrect');
                    return;
                }
                
                // Mettre à jour le mot de passe
                userAccounts[userIndex].password = newPassword;
                localStorage.setItem('userAccounts', JSON.stringify(userAccounts));
                
                // Mettre à jour currentUser
                currentUser.password = newPassword;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                alert('Mot de passe mis à jour avec succès');
                document.getElementById('securityModal').style.display = 'none';
                
                // Réinitialiser les champs
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmNewPassword').value = '';
            });
            
            // Afficher les informations initiales
            displayProfileInfo();
        });
    </script>
</body>
</html>
